# 物流站点 — 功能与操作手册

本文档分为**客户端**与**管理员端**两大部分，说明各功能与操作步骤。

---

# 一、客户端功能与操作手册

## 1. 访问与导航

- **入口**：在浏览器打开站点首页（如 `https://你的域名/` 或本地 `http://localhost:3000`）。
- **顶部导航**：首页、运费计算、物流查询、积分商城、物流故事、关于我们。
- **语言切换**：导航栏提供语言切换（如 中文/English），切换后整站文案随之变化。
- **移动端**：点击右上角菜单图标可展开/收起导航与用户入口。

## 2. 登录与注册

- **入口**：未登录时，点击导航栏「登录/注册」打开弹窗。
- **登录**：选择「登录」标签，输入邮箱、密码，点击登录。登录成功后弹窗关闭，导航栏显示个人中心、积分、签到、退出。
- **注册**：选择「注册」标签，填写邮箱、密码、姓名（可选），提交后根据站点配置可能需在邮箱中确认；确认后可登录。
- **签到**：登录后每日可点击「签到」领取积分（具体积分值由后台站点设置决定）。

## 3. 首页

- **Banner**：顶部大图或渐变背景，由管理员在「首页装修」中配置。
- **公告**：若有配置，顶部会显示横向滚动公告文字。
- **快捷入口**：三个主按钮——运费计算、物流查询、积分商城（图标可由管理员配置）。
- **运费计算器**：首页内嵌一段运费估算（目的地、运输方式、尺寸重量、计算）；可跳转到「运费计算」页进行完整操作并下单。
- **物流查询**：首页内嵌单号查询框，输入单号即可查物流轨迹。
- **积分商城**：展示积分淘货商品列表（直拍/竞拍），点击可进入商品详情或直接兑换/出价。
- **物流故事**：展示故事卡片列表，点击进入故事详情。
- **服务介绍**：底部有服务简介与说明。

## 4. 运费计算（/shipping-calc）

- **用途**：按目的地、运输方式、包裹尺寸与重量估算计费重与运费，并可创建集运订单。
- **操作步骤**：
  1. 选择**目的地**（如台湾 tw、泰国 th、柬埔寨 kh、马来西亚 my、印尼 id 等）。
  2. 选择**运输方式**（根据目的地动态显示可选方式）。
  3. 填写**长、宽、高**（cm）和**实际重量**（kg）。系统按体积重（长×宽×高/6000）与实重取大者作为计费重。
  4. 点击「计算」得到：计费重、单价、预估运费。
- **保存为订单**：计算完成后，若已登录，可点击「保存为订单」：系统会创建一笔待确认的集运订单（状态「待确认」），并弹出成功提示（含订单 ID、单号、运费）。未登录会提示先登录。
- **后续**：在「个人中心」→「我的订单」中可对该订单补全物流信息、上传支付凭证等。

## 5. 物流查询（/tracking）

- **用途**：凭物流单号查询订单状态与物流轨迹（无需登录）。
- **操作**：在输入框输入单号，点击「查询」。若存在该单号，会显示订单状态与时间轴形式的物流进度（状态标题、地点、描述、时间）。

## 6. 积分商城（/points-shop）

- **列表页**：展示所有上架中的积分淘货商品（名称、图、所需积分、标签、直拍/竞拍等）。
- **商品详情页**（/points-shop/[id]）：可查看多图轮播、名称、描述、起拍/直拍积分、预设运费、库存等；支持「立即出价」或「立即兑换」。
- **直拍商品**：点击「立即兑换」后，若积分足够则扣减积分、扣减库存，并生成一笔淘货订单（类型为「自营」），需支付预设运费；提示去个人中心完成后续步骤。
- **竞拍商品**：点击「立即出价」后，若积分不少于起拍积分则参与竞拍（扣减起拍积分），竞拍结束后由管理员「结拍」；中标者自动生成订单，未中标者积分退回。
- **积分不足**：会提示当前积分与所需积分，需先通过签到或订单完成后获得积分。

## 7. 物流故事（/stories、/stories/[id]）

- **列表**：展示所有已发布的物流故事卡片（封面图、标题、摘要、日期），点击进入详情。
- **详情**：展示故事标题、分类、正文内容与发布时间（内容由管理员在后台维护）。

## 8. 关于我们（/about）

- **内容**：公司简介、服务宗旨、配图、联系说明、WhatsApp 链接等，均由管理员在「关于我们」后台配置；若未配置则显示默认文案。

## 9. 个人中心 / 我的订单（/dashboard）

- **入口**：登录后点击导航栏「个人中心」。
- **信息展示**：当前登录邮箱、积分余额。
- **我的订单**：列表展示当前用户全部订单，每条显示：单号（或「待分配」）、状态、运费、订单类型（淘货会标「自营」）、创建日期。
- **待确认 + 未补全运单**：若订单状态为「待确认」且未填齐货物品名与收寄信息，会提示「请补全物流信息」；点击订单进入详情页可填写。
- **待确认 + 已补全**：显示「信息已完整，等待客服确认」等提示。

## 10. 订单详情（/dashboard/orders/[id]）

- **入口**：在个人中心订单列表中点击某条订单。
- **通用**：
  - 顶部有「后续步骤指引」与「联系客服」按钮；联系客服时可选择渠道（如 WhatsApp、Line 等），并自动携带订单号等咨询文案。
  - 物流详情：单号、状态、运费；若有收货人/寄件人/货物品名会一并展示。
  - 物流时间轴：按时间倒序展示每条轨迹（状态标题、地点、描述、时间）。
- **集运订单（非淘货）**：
  - **待确认**：需补全「货物品名」「寄件人」「收件人」信息，提交后等待客服确认。
  - **国内单号**：可录入发往集运仓的国内快递单号并保存。
  - **支付凭证**：上传支付凭证图片（JPG/PNG/WebP/GIF，≤5MB），可查看、重新上传。
- **淘货订单（自营）**：
  - 无需寄送集运仓；需支付预设运费。
  - 可填写/修改「收货人姓名、电话、地址」并保存。
  - 上传支付凭证后等待管理员确认收款与发货；可查看物流时间轴。
- **商品信息**：若为淘货订单，会展示所兑换商品名称与图片。

---

# 二、管理员端功能与操作手册

## 1. 访问与权限

- **入口**：使用**管理员账号**登录后，导航栏会出现「管理后台」链接；点击进入 `/admin-control`。
- **权限**：仅 `profiles.role = 'admin'` 的用户可访问；非管理员访问会提示「权限不足」并在约 3 秒后跳转首页。
- **待处理提示**：管理员在导航栏可看到待处理订单数量角标（如有），便于快速进入订单管理。

## 2. 后台整体布局

- **左侧导航**：订单管理、竞拍结拍、淘货商品、淘货发布、运费管理、物流故事、首页装修、关于我们；点击锚点滚动到对应区块。
- **右侧内容**：各功能区块自上而下排列，同一页内可滚动操作。

## 3. 订单管理

- **筛选**：按订单状态、单号（模糊）、用户邮箱（模糊）、货物品名（模糊）筛选，点击「筛选」刷新列表。
- **列表字段**：订单号、单号、用户邮箱、货物品名、状态、运费、支付凭证缩略图、创建时间、操作。
- **淘货订单**：货物品名前列有「自营」标签。
- **操作**：
  - **确认收款**：对未「已支付/待出库/已完成」的订单，可点击「确认收款」将订单推进为已支付等状态（具体以接口逻辑为准）。
  - **一键发货**：仅对「淘货」且状态为「待出库」的订单显示；点击后系统写入一条「平台已打包，正在安排出库」类轨迹并将状态更新为「运输中」。
  - **确认结算**：对未「已完成」的订单可执行「确认结算」，完成订单并给用户发放积分（1:1，具体以业务逻辑为准）；已完成不可重复结算。
  - **更新进度**：打开弹窗填写「当前位置」「状态描述」，保存后为该订单新增一条物流轨迹。
  - **状态下拉**：可直接修改订单状态（待确认、待付款、待支付运费、已支付、待出库、已入库、运输中、已完成等）。
  - **管理轨迹**：跳转到该订单的「管理轨迹」详情页（见下文）。
- **凭证查看**：点击凭证缩略图可放大查看支付凭证大图。

## 4. 管理轨迹（/admin-control/orders/[id]）

- **入口**：在订单管理列表中点击某订单的「管理轨迹」。
- **订单信息**：单号、状态、运费、收寄信息、货物品名等；可编辑并保存「物流单号」；提供「生成单号」按钮（格式如 EX+UUID 前 8 位）便于快速填入再保存。
- **新增轨迹**：选择预设状态（如已收货、运输中、清关中、派送中、已签收等）或「自定义」输入状态标题，可选填地点、描述；可同时更新订单状态。保存后时间轴即更新。
- **确认收款 / 确认结算**：与订单管理列表中的操作一致，可在本页完成。

## 5. 竞拍结拍

- **说明**：仅展示「积分竞拍」且未结拍的商品（有结束时间、未执行结拍）。
- **操作**：对到期竞拍点击「结拍」。系统会确定最高出价者、为其生成物流订单、退还未中标者积分；结拍成功后提示生成订单 ID。

## 6. 淘货商品管理

- **列表**：展示所有积分淘货商品（名称、起拍积分、预设运费、库存、标签、类型直拍/竞拍）；支持「编辑」。
- **新增商品**：点击「新增商品」，在弹窗中填写：
  - 商品名称、描述、商品图片（可选，≤2MB，上传前会压缩为 WebP）
  - 起拍积分、直拍积分（可选）、预设运费（元）、库存、标签、按钮文案、排序、是否竞拍、竞拍结束时间（竞拍时必填）
- **编辑**：点击某商品「编辑」，修改上述字段后保存；可更换图片。
- **说明**：兑换/竞拍生成订单时，将使用该商品的「预设运费」作为订单运费。

## 7. 淘货发布中心

- **多图上传**：支持一次选择多张图片，自动压缩后上传至商品图库（WebP）；上传成功的 URL 会加入列表供发布时选用。
- **发布新商品**：填写名称、描述、所需积分、预设运费、库存等，选择已上传的图片（可多图），选择「直拍」或「竞拍」及结束时间，提交后生成新淘货商品并上架。
- **列表**：展示已发布商品，支持「下架」「删除」等操作（具体以界面为准）。

## 8. 运费管理

- **列表**：查看当前所有运费配置（国家、运输方式、单价、起运重、重量上限、币种、时效等）；支持单元格内编辑「单价」「时效」并保存。
- **CSV 上传**：
  - 下载空白或带示例的 CSV 模板（表头：country, method, price_per_kg, min_weight, estimated_days 等）。
  - 填写或映射表头后上传；支持「Dry Run」预览将新增/更新的记录及错误行，确认后再执行导入。
- **调价**：支持按比例或固定值批量调整某国家/某方式的单价（具体以界面「调价」标签为准）。
- **历史**：可查看运费变更历史（若有）。

## 9. 物流故事

- **列表**：展示所有物流故事（标题、封面、创建时间）；支持新增、编辑、删除。
- **新增/编辑**：填写标题、分类（如避坑指南、时效预警、客户案例、其他）、摘要、正文；上传封面图（自动压缩后上传至站点资源）。保存后前台列表与详情页即更新。

## 10. 首页装修

- **配置项**：首页 Banner URL、客服 WhatsApp 链接、滚动公告文字等（以及站点设置中的 home_icon_shipping、home_icon_tracking、home_icon_points_shop 等，若后台有对应表单项）。
- **操作**：在输入框中填写或修改 URL/文字，点击「保存」；保存后首页立即拉取最新配置生效。

## 11. 关于我们

- **配置项**：关于我们 Hero 图、标题、副标题、公司简介（多行）、服务宗旨（多行）、配图 URL、联系我们说明、WhatsApp 链接等。
- **操作**：编辑各字段后保存；关于我们页面会立即使用最新内容。

## 12. 站点设置与上传

- **站点设置**：通过「首页装修」「关于我们」等区块对 `site_settings` 进行 upsert；部分配置（如签到积分、体积重系数等）可能在数据库或其它管理界面中维护。
- **上传**：
  - **商品图片**：在淘货商品编辑/淘货发布中心中上传，写入 `product-images` 桶。
  - **支付凭证**：用户在前台上传，写入 `payment-proofs` 桶。
  - **站点资源**：物流故事封面等通过「上传站点资源」上传至 `site-assets` 桶。

---

# 三、订单状态与流程简述

- **集运订单**：待确认 → 用户补全运单信息 → 客服确认 → 待付款/待支付运费 → 用户上传支付凭证 → 确认收款 → 待出库 → 已入库/运输中 → … → 已完成 → 确认结算（发积分）。
- **淘货订单**：生成后为待确认/待支付运费 → 用户填收货人、上传支付凭证 → 确认收款 → 待出库 → 管理员「一键发货」→ 运输中 → … → 已完成 → 确认结算（发积分）。

---

# 四、环境与依赖说明

- 站点数据与用户认证依赖 **Supabase**（项目 URL 与 anon key 配置于 `.env.local`）。
- 后台管理员需在 Supabase 的 `profiles` 表中将对应用户的 `role` 设为 `admin`。
- 首次部署或更换 Supabase 项目时，请参考 [SUPABASE_SWITCH_CHECKLIST.md](./SUPABASE_SWITCH_CHECKLIST.md) 与 [STORAGE_SETUP.md](./STORAGE_SETUP.md) 完成迁移与存储桶配置。

---

# 五、客户端与管理员端路由速查

| 类型   | 路径 | 说明 |
|--------|------|------|
| 客户端 | `/` | 首页 |
| 客户端 | `/shipping-calc` | 运费计算 |
| 客户端 | `/tracking` | 物流查询 |
| 客户端 | `/points-shop` | 积分商城列表 |
| 客户端 | `/points-shop/[id]` | 商品详情 |
| 客户端 | `/stories` | 物流故事列表 |
| 客户端 | `/stories/[id]` | 故事详情 |
| 客户端 | `/about` | 关于我们 |
| 客户端 | `/dashboard` | 个人中心（我的订单） |
| 客户端 | `/dashboard/orders/[id]` | 订单详情 |
| 管理员 | `/admin-control` | 管理后台（订单/淘货/运费/故事/首页/关于我们等） |
| 管理员 | `/admin-control/orders/[id]` | 订单轨迹管理 |

---

*文档版本与项目代码同步，若功能有增删请以实际界面与接口为准。*

---

## 导出为 Word 文档 (.docx)

- **方式一（推荐）**：用 **Microsoft Word** 打开同目录下的 `USER_MANUAL.html`，再点击「文件」→「另存为」→ 选择保存类型「Word 文档 (*.docx)」，即可得到 Word 文档。
- **方式二**：若已安装 [Pandoc](https://pandoc.org/)，在项目根目录执行：  
  `pandoc docs/USER_MANUAL.md -o docs/USER_MANUAL.docx`
